<!DOCTYPE html>
<html>

<head>
    <title>MaZe City Heatmap</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding: 20px;
        }

        #map-container {
            height: 600px;
            width: 100%;
            border: 1px solid #ccc;
            margin-top: 20px;
        }

        .slider-label {
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="mb-4">MaZe: Optimal City Location Finder</h1>

        <div class="row">
            <div class="col-md-4">
                <form action="/generate_map" method="post">
                    <div class="mb-3">
                        <label for="city" class="form-label">City Name</label>
                        <input type="text" class="form-control" id="city" name="city"
                            value="{{ city if city else 'Paris' }}" list="cityList" autocomplete="off" required>
                        <datalist id="cityList"></datalist>
                        <div class="form-text">Start typing to see suggestions</div>
                    </div>

                    <h4 class="mt-4">Preferences (0-10)</h4>

                    <div class="mb-3">
                        <label for="supermarket_weight" class="form-label slider-label">Supermarket</label>
                        <input type="range" class="form-range" id="supermarket_weight" name="supermarket_weight" min="0"
                            max="10" value="5">
                    </div>

                    <div class="mb-3">
                        <label for="bakery_weight" class="form-label slider-label">Bakery</label>
                        <input type="range" class="form-range" id="bakery_weight" name="bakery_weight" min="0" max="10"
                            value="5">
                    </div>

                    <div class="mb-3">
                        <label for="metro_weight" class="form-label slider-label">Metro Station</label>
                        <input type="range" class="form-range" id="metro_weight" name="metro_weight" min="0" max="10"
                            value="5">
                    </div>

                    <div class="mb-3">
                        <label for="bus_weight" class="form-label slider-label">Bus Stop</label>
                        <input type="range" class="form-range" id="bus_weight" name="bus_weight" min="0" max="10"
                            value="5">
                    </div>

                    <div class="mb-3">
                        <label for="tram_weight" class="form-label slider-label">Tram Stop</label>
                        <input type="range" class="form-range" id="tram_weight" name="tram_weight" min="0" max="10"
                            value="5">
                    </div>

                    <div class="mb-3">
                        <label for="rent_weight" class="form-label slider-label">Rent Price (Placeholder)</label>
                        <input type="range" class="form-range" id="rent_weight" name="rent_weight" min="0" max="10"
                            value="5" disabled>
                        <div class="form-text">Rent data integration coming soon.</div>
                    </div>

                    <h4 class="mt-4">Search Area</h4>

                    <div class="mb-3">
                        <label for="radius" class="form-label slider-label">Radius: <span
                                id="radius_value">3000</span>m</label>
                        <input type="range" class="form-range" id="radius" name="radius" min="500" max="10000"
                            step="500" value="3000"
                            oninput="document.getElementById('radius_value').textContent = this.value">
                        <div class="form-text">Search radius around city center (500m - 10km)</div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100">Generate Heatmap</button>
                </form>
            </div>

            <div class="col-md-8">
                {% if map_html %}
                <div id="map-container">
                    {{ map_html | safe }}
                </div>
                {% else %}
                <div class="alert alert-info mt-4">
                    Enter a city and adjust preferences to generate a heatmap of optimal locations.
                </div>
                {% endif %}

                {% if error %}
                <div class="alert alert-danger mt-4">
                    {{ error }}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        // City autocomplete
        const cityInput = document.getElementById('city');
        const cityList = document.getElementById('cityList');
        let debounceTimer;

        cityInput.addEventListener('input', function () {
            const query = this.value;

            // Clear previous timer
            clearTimeout(debounceTimer);

            // Debounce API calls
            debounceTimer = setTimeout(async () => {
                if (query.length < 2) {
                    cityList.innerHTML = '';
                    return;
                }

                try {
                    const response = await fetch(`/api/cities?q=${encodeURIComponent(query)}`);
                    const cities = await response.json();

                    cityList.innerHTML = '';
                    cities.forEach(city => {
                        const option = document.createElement('option');
                        option.value = city.name;
                        option.textContent = city.display;
                        cityList.appendChild(option);
                    });
                } catch (error) {
                    console.error('Error fetching cities:', error);
                }
            }, 300);
        });
    </script>
</body>

</html>